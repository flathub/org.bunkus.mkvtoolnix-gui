app-id: org.bunkus.mkvtoolnix-gui
default-branch: stable
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: mkvtoolnix-gui
rename-icon: mkvtoolnix-gui
finish-args:
  - --socket=wayland
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=host
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/man
  - '*.a'
  - '*.la'
modules:

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=filesystem,system
      - ./b2 -j $FLATPAK_BUILDER_N_JOBS install
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.73.0/source/boost_1_73_0.tar.bz2
        sha256: 4eb3b8d442b426dc35346235c8733b5ae35ba431690e38c6a8263dce9fcbb402

  - name: cmark
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMARK_STATIC=OFF
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://github.com/commonmark/cmark/archive/0.29.0.tar.gz
        sha256: 2558ace3cbeff85610de3bda32858f722b359acdadf0c4691851865bb84924a6

  - name: libdvdcss
    sources:
      - type: archive
        url: http://ftp.videolan.org/videolan/libdvdcss/1.4.2/libdvdcss-1.4.2.tar.bz2
        sha256: 78c2ed77ec9c0d8fbed7bf7d3abc82068b8864be494cfad165821377ff3f2575

  - name: libdvdread
    sources:
      - type: archive
        url: http://ftp.videolan.org/videolan/libdvdread/6.1.1/libdvdread-6.1.1.tar.bz2
        sha256: 3e357309a17c5be3731385b9eabda6b7e3fa010f46022a06f104553bf8e21796

  - name: mkvtoolnix
    buildsystem: simple
    build-commands:
      - ./configure
        --enable-optimization
        --enable-debug
        --prefix=/app
        --with-boost=/app
        --with-docbook-xsl-root=/usr/share/xml/docbook/xml/xsl-stylesheets
        --disable-update-check
      - rake
      - rake install
    sources:
      - type: archive
        url: https://mkvtoolnix.download/sources/mkvtoolnix-50.0.0.tar.xz
        sha256: 58a5d2c134e476386a1b391913d68d3e1c51dba70f6a33ca4b39c7b61c2e8824
