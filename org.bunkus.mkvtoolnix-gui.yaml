app-id: org.bunkus.mkvtoolnix-gui
branch: stable
runtime: org.kde.Platform
runtime-version: '5.11'
sdk: org.kde.Sdk
command: mkvtoolnix-gui
rename-icon: mkvtoolnix-gui
finish-args:
  - --socket=wayland
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=host
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/man
  - '*.a'
  - '*.la'
modules:
  - name: ruby # for rake
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://cache.ruby-lang.org/pub/ruby/2.5/ruby-2.5.1.tar.gz
        sha256: dac81822325b79c3ba9532b048c2123357d3310b2b40024202f360251d9829b1

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=regex,filesystem,system,date_time
      - ./b2 -j $FLATPAK_BUILDER_N_JOBS install
    sources:
      - type: archive
        url: https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.bz2
        sha256: 7f6130bc3cf65f56a618888ce9d5ea704fa10b462be126ad053e80e553d6d8b7

  - name: cmark
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://github.com/commonmark/cmark/archive/0.28.3.tar.gz
        sha256: acc98685d3c1b515ff787ac7c994188dadaf28a2d700c10c1221da4199bae1fc

  - name: file # runtime doesn't include "magic.h"
    cleanup:
      - /bin
    sources:
      - type: archive
        url: ftp://ftp.astron.com/pub/file/file-5.34.tar.gz
        sha256: f15a50dbbfa83fec0bd1161e8e191b092ec832720e30cd14536e044ac623b20a

  - name: mkvtoolnix
    buildsystem: simple
    build-commands:
      - ./configure --prefix=/app --with-boost=/app
      - rake
      - rake install
    sources:
      - type: archive
        url: https://mkvtoolnix.download/sources/mkvtoolnix-28.2.0.tar.xz
        sha256: aa54b39790e619b2cfdefdd083c735503834eb05c665cd85f9b5a8383bcc5843
